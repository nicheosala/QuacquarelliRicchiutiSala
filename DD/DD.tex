\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage[super,negative]{nth}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{subfig}
\usepackage{color, soulutf8}
\usepackage{graphicx}
\usepackage{grffile}

\usepackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=black,
	filecolor=black,      
	urlcolor=black,
}

\usepackage[dvipsnames]{xcolor}
\usepackage{listings}

\renewcommand{\thefigure}{\arabic{section}.\arabic{figure}}
\newcommand\goal[1]{\item[{[G#1]}] }
\newcommand\requirement[1]{\item[{[R#1]}] }
\newcommand\assumption[1]{\item[{[A#1]}] }
\newcommand\usecase[1]{ [UC#1] }

\begin{document}
	\begin{titlepage}
		
		\centering
		\vspace*{0.7 cm}
		\includegraphics[scale = 0.7]{images/PolimiLogo.png}\\[1 cm]
		\textsc{\large Dipartimento di Elettronica, Informazione e Bioingegneria}\\[2 cm]
		
		\rule{\linewidth}{0.2 mm} \\[0.5 cm]
		{\huge \bfseries Design Document (DD)}\\
		\rule{\linewidth}{0.2 mm} \\[1.5 cm]
		
		\textsc{\Large SafeStreets}\\[0.5 cm]
		\textsc{\large - v1.0 -}\\[1 cm]
		
		\begin{minipage}{\textwidth}
			\begin{flushleft} \large
				\emph{Authors:}\\
				\textbf{Quacquarelli} Sebastiano \hfill 945071 \\
				\textbf{Ricchiuti} Simone \hfill 945613  \\
				\textbf{Sala} Nicolò \hfill 945898  \\[2 cm]
			\end{flushleft}
		\end{minipage}\\[2 cm]
		
		{\large December \nth{9} , 2019}\\[2 cm]
		
	\end{titlepage}
	
	\pagenumbering{roman}
	\tableofcontents
	\clearpage
	\newpage
	\pagenumbering{arabic}
	\setcounter{page}{1}
	
	\section{Introduction}
		\subsection{Purpose}
		The main aspects of SafeStreets system are presented in the RASD document (see References section). The purpose of this document is to describe in a more detailed way the technical aspects regarding architectural and design choices for SafeStreets components.\\\\
		More precisely, the document presents:
		\begin{itemize}
			\item Overview of the high level architecture;
			\item The main components, their interfaces; 
			\item The runtime behaviour; 
			\item The design patterns;
			\item Additional details about user interface;
			\item A mapping of the requirements on the architecture's components;
			\item Implementation, integration and testing plan;
		\end{itemize}
		\subsection{Scope}
		In this section is shortly summarised what is already defined in a more detailed way in the \textit{Scope} section of the RASD document. \\
		SafeStreets's scope is to give the opportunity to report traffic violations by users and eventually to manage them by the competent authority in an easy way. Basically users can simply open the SafeStreets Application on their smartphones and immediately take a picture of the traffic violation to report. Including a few more other informations, such as selecting the type of violation, the report is done and is ready to be sent to SafeStreets system.\\ On the other hand, authorities in collaboration with SafeStreets, collect all the received reports and can check them on their SafeStreets Authority Edition (desktop dedicated application).\\ Valuating reports, authorities can eventually define them consistent or not and, if consistent valuated, they fine the offender reported.\\
		These ones are the basic functionalities offered by SafeStreets but also other ones are offered to individuals:
		\begin{itemize}
			\item Users can browse the map to know statistics about traffic violations sent to SafeStreets and their status (confirmed or not by authorities);
			\item Authorities can browse map such as users but including access also to sensitive informations such as license plates included in reports;
			\item Authorities can access to advanced statistics such as filtering results to return the most egregious offender;
			\item Authorities can also send to SafeSteets system accident information in order to enrich SafeStreets' database. It is important becouse authorities can receive suggestions from SafeStreets system to improve the security of streets according to violations and accidents occurred in a defined area.
		\end{itemize}
		\subsection{Definitions, Acronyms, Abbreviations}
		\subsubsection{Definitions}
		\begin{itemize}
			\item \textbf{Operative area}: the geographic area in which an authority retains  control and actually works.
			\item \textbf{Registered authority}: an authority that decided to participate in SafeStreets initiative and that installed in its head office a particular version of the application that provides some features not available to common users (for example, the possibility to rate the traffic violation reports collected by SafeStreets).
			\item \textbf{Report image}: it is the image acquired through the SafeStreets app. It is obligatorily associated with a valid report.
			\item \textbf{Report timeout}: it is the timeout started when SafeStreets app acquires the report image. If the user doesn't complete the completion of the report by the deadline of this timeout, the report is considered invalid.
			\item \textbf{SafeStreets}: it is the crowdfunding app subject of this document.
			\item \textbf{SafeStreets application}: it is the application used by users, installed on their smartphone.
			\item \textbf{SafeStreets Authority Edition}: it is the application used by authorities, installed on computers in their station.
			\item \textbf{SafeStreets Client}: a generic way to point out the SafeStreets application or the SafeStreets Authority Edition.
			\item \textbf{Traffic violation report}: it is the message that SafeStreets collects through its app from users who want to report an alleged violation. It is often abbreviated as "report".
			\item \textbf{Individual}: A generic user or authority.
		\end{itemize}
		\subsubsection{Acronyms}
		\begin{itemize}
			\item \textbf{AE} \label{AE}: SafeStreets Authority Edition.
			\item \textbf{OCR} \label{OCR}: Optical Character Recognition
		\end{itemize}
		\subsubsection{Abbreviations}
		\begin{itemize}
			\item {[Gn]}: n\textsuperscript{th} goal.
			\item {[Rn]}: n\textsuperscript{th} functional requirement.
			\item {[An]}: n\textsuperscript{th} domain assumption.
			\item {[UCn]}: n\textsuperscript{th} use case.
		\end{itemize}
		\subsection{Revision history}
			\begin{table}[h]
				\centering
				\begin{tabular}{c c c}
					\hline
					\textbf{Version} & \textbf{Last update} & \textbf{Comments} \\ 
					\hline
					1.0 &  \nth{9} December, 2019  & \\
					\hline
				\end{tabular}
				\caption{Revision history}
				\label{fig:Revision history}
			\end{table}
		\subsection{Document structure}
			In this part is shown how the document has been divided. For each chapter, is given a short description:
			\begin{itemize}
				\item \textit{Chapter 1} gives an introduction of the design document. It contains the purpose of the document and the scope of the SafeStreets system, as well as some abbreviation in order to provide a better understanding of the document to the reader.
				\item \textit{Chapter 2} is the core section of the design document and it deals with the architectural design of the application. It gives an overview of the architecture and it also contains the most relevant architecture views: 
				\begin{itemize}
					\item High-‐level components and their interactions;
					\item Component view;
					\item Class view;
					\item Deployment view;
					\item Runtime view. 
				\end{itemize}
			  	Some of the used architectural designs and designs patterns are also presented here, with an explanation of each one of them and the purpose of their usage.				
				\item \textit{Chapter 3} refers to the mock-ups already presented in the RASD document including some more detailed versions of them such as interaction diagrams.
				\item \textit{Chapter 4} explains how the requirements that have been deﬁned in the RASD are assigned to the design elements deﬁned in this document.
				\item \textit{Chapter 5} presents the implementation, integration and test plan. It includes the how the different components of the application are integrated with each other, how they react and the testing strategy.				
				\item \textit{Chapter 6}  shows the effort spent by each group member while working on this document.
				\item \textit{Chapter 7} simply includes the references.
			\end{itemize}
	\section{Architectural design}
		\subsection{Overview}
		In this section is defined the high-level architecture of SafeStreets' system. \\ 
		Figure \ref{fig:hinteraction_diagram} represents the high level interaction between the main parts of SafeStreets' structure.
		\begin{figure}[H]
			\includegraphics [scale=0.5] {diagrams/high-interaction.png}
			\caption[High-Level Interaction]{High-Level Interaction diagram}
			\label{fig:hinteraction_diagram}
		\end{figure}
		The figure describes how individuals interact with SafeStreets. Only one user is represented on the left and only one authority on the right, but this is only made to define clearly interactions. The real system is actually composed by multiple individuals.\\
		Basically everyone can download the SafeStreets application on his smartphone and can be an \textit{user}. On the other hand the Authority Edition is distributed by SafeStreets only to certificated \textit{authorities} that wants to collaborate with it. 
		\begin{figure}[H]
			\includegraphics [scale=0.5] {diagrams/High-level.png}
			\caption[High-Level Layers]{High-Level layers}
			\label{fig:hlayers}
		\end{figure}
		In figure \ref{fig:hlayers}	are defined three software logic layers on which the system is defined. \\
		The \textit{Individuals Layer} includes the two different kind of applications used by individuals. The distinction between applications is made because the two different implementation include different functionalities and, eventually, a different kind of interaction with the server with respect to the granularity of informations exchanged between them. \\
		The \textit{Server Layer} contains all the managerial components to interact correctly with individuals. It is also important as a security step. Indeed, individuals never communicate with the DBMS, that contains sensitive informations. They have to make requests to server and it manage them forwarding data requests to the DBMS. \\
		The \textit{Data Layer} is simply defined only by the data management system, that collects and execute queries from relational databases.
		
		\clearpage
		\subsection{Component view}
		Figure \ref{fig:component_diagram} represents all the components of SafeStreets ecosystem.\\
		The diagram focuses on the applicative layer: the view layer is described in the section "User interfaces" of the RASD.\\
		The diagram underlines that the clients, SafeStreets app and SafeStreets AE, are not thin: they include part of the application logic.\\
		
		\begin{figure}[H]
			\includegraphics [scale=0.8] {diagrams/component_diagram.png}
			\caption[Component diagram]{Component diagram}
			\label{fig:component_diagram}
		\end{figure}
		
		\clearpage
		For each component of each node, a description of its role is given.
		
		\subsubsection{SafeStreets App components}
		\begin{itemize}
			\item \textbf{Violation report manager}\\
			It deals with the management of a request for a violation report. First of all, it manages the acquisition of the reporting image: it automatically retrieves information about date, time and position. Afterwards, it forwards the image to the license plate recognition algorithm (OCR). If the algorithm returns a valid license plate and the user confirms the request by the deadline of the reporting timeout, then the violation report manager sends such report to the SafeStreets Server through the "violation report" interface.
			\item \textbf{User data-mining}\\
			This component provides data mining and statistical survey capabilities to SafeStreets app. Remember that SafeStreets App doesn't receive information considered private from the server, in particular it doesn't receive the license plates associated to violations or accidents. The component retrieves information from the server through the "anonymous data" interface.
			\item \textbf{OCR}\\
			This is the software used in order to retrieve a valid license plate from the reporting image. When it receives an image from the violation report manager, it looks for a valid license plate into the image, then returns an error message or the license plate found.
			\item \textbf{Timeout manager}\\
			It manages the report timeout. When the user starts a new violation report request, a timeout starts: if the timeout ends, the timeout manager sends a message to the violation report manager in order to cancel the current violation report request.
		\end{itemize}
		\subsubsection{SafeStreets AE components}
		\begin{itemize}
			\item \textbf{Violation report evaluator}\\
			This component receives violation reports from the server, via the "violation report evaluation" interface. After that, it manages the evaluation of the same by the authority. Once the evaluation has taken place, the violation report evaluator sends the result to the server through the aforementioned interface.
			\item \textbf{Authority data-mining}\\
			This component provides data mining and statistical survey capabilities to SafeStreets AE. Remember that SafeStreets AE can also retrieve information about the license plates linked to accidents and violations. The component retrieves information from the server through the "complete data" interface.
			\item \textbf{Suggestion receiver}\\
			It waits for suggestions from the SafeStreets Server, listening the "suggestion" interface. Then it forwards the information to the view and stores the received suggestion into a database, which is not shown into the component diagram because its role is not very relevant.
			\item \textbf{Accident manager}\\
			It manages the forwarding of incident-related information from an authority to SafeStreets Server. It ensures that the reporting of the accident is accompanied by all the data deemed necessary (see RASD, 3.2.1 for more details), after which it forwards the same to the server through the "accident" interface.
		\end{itemize}
		\subsubsection{SafeStreets Server components}
		\begin{itemize}
			\item \textbf{Violation report router}\\
			It passes violation reports received from users to the database. Also, it routes them to the authorities through the "violation report evaluation" interface, so they can be evaluated. The router follows a precise routing policy: it reads the position associated with the violation report, after which it consults the authority database: if there is an authority with has "municipal" jurisdiction for that area, the report is forwarded to it. Otherwise, an authority with "provincial" competence is sought for that area. If this is not the case, an authority with "state" jurisdiction is sought. If no authority can handle the validation of the report, it is not forwarded to any authority.
			\item \textbf{Data-mining manager}\\
			This component handles data requests from SafeStreets clients. In particular, it deals with extracting the data requested from the SafeStreets database, through the DB manager, filtering such data according to the authorizations of visibility available to the applicant. If the applicant is an authority, it can view all the data; if you are a user, the license and image information is deleted before sending it through the "anonymous data" interface.
			\item \textbf{Suggestion generator}\\
			When SafeStreets Server receives a new confirmation of violation or a new incident report, it is also received by this component, which compares the newly obtained data with those already saved in the database. Depending on a table of which it is available, it can generate advice to be sent to the authorities in order to avoid the repetition of certain dangerous situations, through the "suggestions" interface.
			\item \textbf{Accident collector}\\
			This component listens for new incident reports through the "accident" interface. The correctness of these reports has already been confirmed by SafeStreets AE, so it is only necessary to send the new data to the DB manager, so that they are saved in the database.
			\item \textbf{DB manager}\\
			It manages the interaction between SafeStreets Server and SafeStreets Database. All the components of the server that wants to interact with the database has to pass through this component. This means that in the event of updates to the structure or operation of the database, only the DB manager may need to be updated, guaranteeing better independence between the server and the database.
		\end{itemize}
		\subsubsection{SafeStreets Database components}
		The database stores all the information used by SafeStreets ecosystem. It is composed by three sub-databases, whose role can easily be understood from their name: \textbf{Violation report DB}, \textbf{Accident DB} and \textbf{Authority DB}.
		
		\subsection{Deployment view}
		\subsection{Runtime	view}
		
		\clearpage
		\subsection{Component interfaces}
		This section describes the methods exposed by each interface that allows the communication between SafeStreets server and clients. They are shown in the component diagram of figure \ref{fig:component_diagram}.\\
		The information exchanged through these interfaces are standardized with respect to the following class diagram.\\
		\begin{figure}[H]
			\includegraphics {diagrams/class_diagram.png}
			\caption[Class diagram]{Class diagram}
			\label{fig:class_diagram}
		\end{figure}
		The class diagram represents only the classes considered fundamental to understand the operation of SafeStreets. In any case, the classes referred to without providing an explicit declaration - for example the "LicensePlate" class - have a name that effectively expresses their meaning.\\
		\\
		A list of interfaces follows. For each interface, all the methods it displays are pointed out. For each method, the necessary input parameters and outputs are indicated.\\
		
		\subsection{Selected architectural styles and patterns}
		\subsection{Other design decision}
	\clearpage	
	\section{User Interface Design}
		To give an approximate idea of how the interfaces of the application should appear, some mockups, both for SafeStreets Application and SafeStreets AE, have been given in \href{run:d:../DeliveryFolder/RASD1.pdf}{RASD} [Section 3.1.1].\\ 
		In order to express the relations among pictures in RASD [3.1.1], here it will be illustrated a pair of UX Diagrams.
		\\\\\\
		Functionalities have been represented with different colours, while "Welcome Screen" and "Main Menu" (in purple) are basically the first graphical approach to the app, in particular "Main Menu" contains the menu voices at its right.
		Each functionality has an own sub-flow: black dotted lines represent optional navigation from a screen to another one; blue dotted lines simply refers to the possibility to go back through screens until "Main Menu" is reached.
		
		\begin{figure}[H]
			\centering
			\includegraphics[width=1\textwidth]{diagrams/UXSafeStreetsApp.png}
			\caption[User Experience diagram for SafeStreets App]{User Experience diagram for SafeStreets App}
			\label{fig:UX_SSApp}
		\end{figure}
	
		Figure \ref{fig:UX_SSApp} shows the possibilities given to users, in order to navigate in SafeStreets application. A user can, for instance, select the "Search Menu" to browse all traffic violations reported in an area, showed in a map and listed together in a list.
		Moreover, optionally, a user can improve its research swiping right a side menu in which he can select some filters: the result of research filtered will be shown as the previous modalities, i.e. in the map with a list.
	
		\begin{figure}[H]
			\centering
			\includegraphics[width=1\textwidth]{diagrams/UXSafeStreetsAE.png}
			\caption[User Experience diagram for SafeStreets AE]{User Experience diagram for SafeStreets AE}
			\label{fig:UX_SSAE}
		\end{figure}
	
		Figure \ref{fig:UX_SSAE} is the user interface flow, designed for authorities who use SafeStreets AE.\\
		Similarly as in figure \ref{fig:UX_SSApp}, here is shown how authorities can explore the offered features. In particular, there's an optional flow which jumps from a result of a research to the "Evaluation" functionality: when an authority browse in a map (using "Search Menu") all traffic violations reported, it can both read information about a particular report and go to evaluation of the same report if and only if its state is pending. In this case, authorities can immediately decide if a report is correct or not valid.
		
	\clearpage	
	\section{Requirements Traceability}
	\clearpage	
	\section{Implementation, integration and test plan}
	
	\clearpage
	\section{Effort Spent}
		\begin{table}[h]
			\centering
			\begin{tabular}{l c}
				\hline\hline
				\multicolumn{2}{c}{\textbf{Team Work}} \\
				\hline
				\textbf{Task} & \textbf{Hours} \\ [0.5ex]
				\hline
				Architectural design & 2  \\
				
				\hline
				\textbf{Total} & 2  \\
				\hline
			\end{tabular}
			\caption{Time spent by all team members}
			\label{fig:Time spent by all team members}
		\end{table}
		
		\begin{table}[h]
			\centering
			\begin{tabular}{l c l c l c}
				\hline\hline
				\multicolumn{6}{c}{\textbf{Individual Work}} \\
				\hline
				\multicolumn{2}{c |}{\textbf{Nicolò Sala}}  &
				\multicolumn{2}{c |}{\textbf{Sebastiano Quacquarelli}} &
				\multicolumn{2}{c}{\textbf{Simone Ricchiuti}}\\
				\hline
				\textbf{Task} & \textbf{Hours}
				& \textbf{Task} & \textbf{Hours}
				& \textbf{Task} & \textbf{Hours} \\ [0.5ex]
				\hline
				%Nicolò								Sebastiano							Simone
				Constraints & 2						& User Interface Design & 3					& Introduction & 4
				\\\hline
				Definitions & 1						&  & 				& Product functions  & 4
				\\\hline
				UC description & 3					&  & 				    & User characteristics  & 0.5 
				\\\hline
				Performance req. & 1				&  & 			& Functional req & 2 
				\\\hline
				Design constraints & 1				&  & 					& UC description & 3  
				\\\hline
				Alloy & 9							&  & 				& Activity Diagrams  & 2  
				\\\hline
				\textbf{Total} & 17					& \textbf{Total} & 3				& \textbf{Total} & 15.5
				\\\hline
			\end{tabular}
			\caption{Time spent by each team member}
			\label{fig:Time spent by each team member}
		\end{table}
	
	\clearpage
	\section{References}
		\begin{itemize}
			\item "2019-2020 Software Engineering 2 mandatory project: goal, schedules and rules";
			\item TeXstudio (\url{https://www.texstudio.org}) to edit the LaTeX document;
			\item Visual Paradigm CE (\url{https://www.visual-paradigm.com/}) to create UML and ArchiMate diagrams.
		\end{itemize} 
	
\end{document}
